<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ é‡åŒ–äº¤æ˜“ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ é‡åŒ–äº¤æ˜“ç³»ç»Ÿ</h1>
            <p>ç®€å• Â· å¯é  Â· é«˜æ•ˆ</p>
        </div>
        
        <div class="cards">
            <div class="card">
                <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                <div class="status-info status-good" id="system-status">
                    <div class="loading"></div> æ­£åœ¨åŠ è½½ç³»ç»ŸçŠ¶æ€...
                </div>
                <button class="btn" onclick="loadSystemStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
            </div>
            
            <div class="card">
                <h3>ğŸ“‹ è‚¡ç¥¨ä¿¡æ¯</h3>
                <div class="status-info status-good" id="stocks-summary">
                    ğŸ“ˆ è¿½è¸ªè‚¡ç¥¨: 5 åª<br>
                    ğŸ’° æ€»ä»·å€¼: $2,847,350<br>
                    ğŸ“Š å¹³å‡è¯„åˆ†: 85.2<br>
                    ğŸ”„ æœ€åæ›´æ–°: åˆšåˆš
                </div>
                <a href="/stocks" class="btn large">ğŸ“Š æŸ¥çœ‹è‚¡ç¥¨è¯¦æƒ…</a>
            </div>
            
            <div class="card">
                <h3>âš¡ å¿«é€Ÿæ“ä½œ</h3>
                <div class="status-info">
                    <p>é€‰æ‹©æ‚¨è¦æ‰§è¡Œçš„æ“ä½œï¼š</p>
                </div>
                <a href="/monitoring" class="btn primary">ğŸš€ å¯åŠ¨ç›‘æ§</a>
                <a href="/auto_trade" class="btn primary">âš¡ è‡ªåŠ¨äº¤æ˜“</a>
                <a href="/backtest" class="btn secondary">ğŸ“ˆ è¿è¡Œå›æµ‹</a>
                <a href="/reports" class="btn">ğŸ“Š æŸ¥çœ‹æŠ¥å‘Š</a>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2025 é‡åŒ–äº¤æ˜“ç³»ç»Ÿ | è®©æŠ•èµ„å˜å¾—ç®€å•æ™ºèƒ½</p>
        </div>
    </div>
    
    <div class="card">
        <h3>ğŸ“‹ è‡ªé€‰è‚¡å¿«é€Ÿç®¡ç†</h3>
        <div class="watchlist-quick-manage">
            <div class="quick-add-section">
                <input type="text" id="quick-stock-input" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç  (å¦‚: AAPL)" style="margin-right: 10px;">
                <button id="quick-add-btn" class="btn primary small">æ·»åŠ åˆ°è‡ªé€‰è‚¡</button>
            </div>
            <div id="current-watchlist" class="current-watchlist">
                <div class="watchlist-loading">æ­£åœ¨åŠ è½½è‡ªé€‰è‚¡åˆ—è¡¨...</div>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
    <script>
        // é¡µé¢ç‰¹å®šçš„JavaScript
        
        // è‡ªé€‰è‚¡ç®¡ç†ç±»
        class HomeWatchlistManager {
            constructor() {
                this.api = new TradingAPI();
                this.watchlist = [];
                this.init();
            }
            
            async init() {
                await this.loadWatchlist();
                this.bindEvents();
            }
            
            bindEvents() {
                document.getElementById('quick-add-btn').addEventListener('click', () => this.addStock());
                document.getElementById('quick-stock-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addStock();
                });
            }
            
            async loadWatchlist() {
                try {
                    const response = await this.api.get('/api/watchlist');
                    if (response.success && response.data) {
                        this.watchlist = response.data;
                    } else {
                        this.watchlist = ['AAPL', 'TSLA', 'NVDA', 'MSFT', 'GOOGL'];
                    }
                    this.updateWatchlistDisplay();
                } catch (error) {
                    console.error('åŠ è½½è‡ªé€‰è‚¡å¤±è´¥:', error);
                    this.watchlist = ['AAPL', 'TSLA', 'NVDA', 'MSFT', 'GOOGL'];
                    this.updateWatchlistDisplay();
                }
            }
            
            async addStock() {
                const input = document.getElementById('quick-stock-input');
                const symbol = input.value.trim().toUpperCase();
                
                if (!symbol) {
                    UIUtils.showAlert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ', 'warning');
                    return;
                }
                
                if (this.watchlist.includes(symbol)) {
                    UIUtils.showAlert('è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰è‚¡ä¸­', 'info');
                    return;
                }
                
                try {
                    const response = await this.api.post('/api/watchlist/add', { symbol: symbol });
                    if (response.success) {
                        this.watchlist = response.data;
                        this.updateWatchlistDisplay();
                        input.value = '';
                        UIUtils.showAlert(`âœ… å·²æ·»åŠ  ${symbol} åˆ°è‡ªé€‰è‚¡`, 'success');
                    } else {
                        UIUtils.showAlert(`âŒ æ·»åŠ å¤±è´¥: ${response.error}`, 'error');
                    }
                } catch (error) {
                    console.error('æ·»åŠ è‚¡ç¥¨å¤±è´¥:', error);
                    UIUtils.showAlert('æ·»åŠ å¤±è´¥: ç½‘ç»œé”™è¯¯', 'error');
                }
            }
            
            async removeStock(symbol) {
                try {
                    const response = await this.api.post('/api/watchlist/remove', { symbol: symbol });
                    if (response.success) {
                        this.watchlist = response.data;
                        this.updateWatchlistDisplay();
                        UIUtils.showAlert(`âœ… å·²ç§»é™¤ ${symbol}`, 'info');
                    } else {
                        UIUtils.showAlert(`âŒ ç§»é™¤å¤±è´¥: ${response.error}`, 'error');
                    }
                } catch (error) {
                    console.error('ç§»é™¤è‚¡ç¥¨å¤±è´¥:', error);
                    UIUtils.showAlert('ç§»é™¤å¤±è´¥: ç½‘ç»œé”™è¯¯', 'error');
                }
            }
            
            updateWatchlistDisplay() {
                const container = document.getElementById('current-watchlist');
                
                if (this.watchlist.length === 0) {
                    container.innerHTML = '<div class="watchlist-loading">è‡ªé€‰è‚¡åˆ—è¡¨ä¸ºç©º</div>';
                    return;
                }
                
                container.innerHTML = this.watchlist.map(symbol => `
                    <div class="watchlist-item">
                        <span>${symbol}</span>
                        <button class="remove-stock" onclick="homeWatchlistManager.removeStock('${symbol}')" title="ç§»é™¤">Ã—</button>
                    </div>
                `).join('');
            }
        }
        
        // å…¨å±€å®ä¾‹
        let homeWatchlistManager;
        
        async function loadSystemStatus() {
            const statusElement = document.getElementById('system-status');
            
            try {
                UIUtils.showLoading(statusElement, 'æ­£åœ¨è·å–ç³»ç»ŸçŠ¶æ€...');
                
                const status = await api.getSystemStatus();
                
                statusElement.innerHTML = `
                    âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸<br>
                    ğŸ• å¯åŠ¨æ—¶é—´: ${status.time}<br>
                    ğŸ’¾ å†…å­˜ä½¿ç”¨: ${status.memory}<br>
                    ğŸŒ ç½‘ç»œè¿æ¥: ${status.network}<br>
                    ğŸ”§ æ•°æ®å¼•æ“: ${status.components?.data_engine || 'è¿è¡Œä¸­'}<br>
                    ğŸ¤– ç­–ç•¥å¼•æ“: ${status.components?.strategy_engine || 'è¿è¡Œä¸­'}
                `;
                statusElement.className = 'status-info status-good';
                
            } catch (error) {
                console.error('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥:', error);
                statusElement.innerHTML = `
                    âŒ ç³»ç»ŸçŠ¶æ€è·å–å¤±è´¥<br>
                    ğŸ”§ è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥<br>
                    ğŸ’¡ å°è¯•åˆ·æ–°é¡µé¢
                `;
                statusElement.className = 'status-info status-error';
            }
        }

                // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            const api = new TradingAPI();
            
            // åˆå§‹åŒ–è‡ªé€‰è‚¡ç®¡ç†å™¨
            homeWatchlistManager = new HomeWatchlistManager();
            
            // åŠ è½½ç³»ç»ŸçŠ¶æ€
            await loadSystemStatus();
        });
    </script>
</body>
</html>