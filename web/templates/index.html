<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ é‡åŒ–äº¤æ˜“ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ é‡åŒ–äº¤æ˜“ç³»ç»Ÿ</h1>
            <p>ç®€å• Â· å¯é  Â· é«˜æ•ˆ</p>
        </div>
        
        <div class="cards">
            <div class="card">
                <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                <div class="status-info status-good" id="system-status">
                    <div class="loading"></div> æ­£åœ¨åŠ è½½ç³»ç»ŸçŠ¶æ€...
                </div>
                <button class="btn" onclick="loadSystemStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
            </div>
            
            <div class="card">
                <h3>ğŸ“‹ è‚¡ç¥¨ä¿¡æ¯</h3>
                <div class="status-info status-good" id="stocks-summary">
                    ğŸ“ˆ è¿½è¸ªè‚¡ç¥¨: 5 åª<br>
                    ğŸ’° æ€»ä»·å€¼: $2,847,350<br>
                    ğŸ“Š å¹³å‡è¯„åˆ†: 85.2<br>
                    ğŸ”„ æœ€åæ›´æ–°: åˆšåˆš
                </div>
                <a href="/stocks" class="btn large">ğŸ“Š æŸ¥çœ‹è‚¡ç¥¨è¯¦æƒ…</a>
            </div>
            
            <div class="card">
                <h3>âš¡ å¿«é€Ÿæ“ä½œ</h3>
                <div class="status-info">
                    <p>é€‰æ‹©æ‚¨è¦æ‰§è¡Œçš„æ“ä½œï¼š</p>
                </div>
                <a href="/monitoring" class="btn primary">ğŸš€ å¯åŠ¨ç›‘æ§</a>
                <a href="/auto_trade" class="btn primary">âš¡ è‡ªåŠ¨äº¤æ˜“</a>
                <a href="/backtest" class="btn secondary">ğŸ“ˆ è¿è¡Œå›æµ‹</a>
                <a href="/reports" class="btn">ğŸ“Š æŸ¥çœ‹æŠ¥å‘Š</a>
            </div>
        </div>
        
        <div class="footer">
            <p>Â© 2025 é‡åŒ–äº¤æ˜“ç³»ç»Ÿ | è®©æŠ•èµ„å˜å¾—ç®€å•æ™ºèƒ½</p>
        </div>
    </div>
    
    <div class="card">
        <h3>ğŸ“‹ è‡ªé€‰è‚¡å¿«é€Ÿç®¡ç†</h3>
        <div class="watchlist-quick-manage">
            <div class="quick-add-section">
                <input type="text" id="quick-stock-input" placeholder="è¾“å…¥è‚¡ç¥¨ä»£ç  (å¦‚: AAPL)" style="margin-right: 10px;">
                <button id="quick-add-btn" class="btn primary small">æ·»åŠ åˆ°è‡ªé€‰è‚¡</button>
            </div>
            <div id="current-watchlist" class="current-watchlist">
                <div class="watchlist-loading">æ­£åœ¨åŠ è½½è‡ªé€‰è‚¡åˆ—è¡¨...</div>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
    <script>
        // é¡µé¢ç‰¹å®šçš„JavaScript
        
        // è‡ªé€‰è‚¡ç®¡ç†ç±»
        class HomeWatchlistManager {
            constructor() {
                this.api = new TradingAPI();
                this.watchlist = [];
                this.init();
            }
            
            async init() {
                await this.loadWatchlist();
                this.bindEvents();
            }
            
            bindEvents() {
                document.getElementById('quick-add-btn').addEventListener('click', () => this.addStock());
                document.getElementById('quick-stock-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addStock();
                });
            }
            
            async loadWatchlist() {
                try {
                    const response = await this.api.get('/api/watchlist');
                    if (response.success && response.data) {
                        this.watchlist = response.data;
                    } else {
                        this.watchlist = ['AAPL', 'TSLA', 'NVDA', 'MSFT', 'GOOGL'];
                    }
                    this.updateWatchlistDisplay();
                } catch (error) {
                    console.error('åŠ è½½è‡ªé€‰è‚¡å¤±è´¥:', error);
                    this.watchlist = ['AAPL', 'TSLA', 'NVDA', 'MSFT', 'GOOGL'];
                    this.updateWatchlistDisplay();
                }
            }
            
            async addStock() {
                const input = document.getElementById('quick-stock-input');
                const symbol = input.value.trim().toUpperCase();
                
                if (!symbol) {
                    UIUtils.showAlert('è¯·è¾“å…¥è‚¡ç¥¨ä»£ç ', 'warning');
                    return;
                }
                
                if (this.watchlist.includes(symbol)) {
                    UIUtils.showAlert('è¯¥è‚¡ç¥¨å·²åœ¨è‡ªé€‰è‚¡ä¸­', 'info');
                    return;
                }
                
                try {
                    const response = await this.api.post('/api/watchlist/add', { symbol: symbol });
                    if (response.success) {
                        this.watchlist = response.data;
                        this.updateWatchlistDisplay();
                        input.value = '';
                        UIUtils.showAlert(`âœ… å·²æ·»åŠ  ${symbol} åˆ°è‡ªé€‰è‚¡`, 'success');
                    } else {
                        UIUtils.showAlert(`âŒ æ·»åŠ å¤±è´¥: ${response.error}`, 'error');
                    }
                } catch (error) {
                    console.error('æ·»åŠ è‚¡ç¥¨å¤±è´¥:', error);
                    UIUtils.showAlert('æ·»åŠ å¤±è´¥: ç½‘ç»œé”™è¯¯', 'error');
                }
            }
            
            async removeStock(symbol) {
                try {
                    const response = await this.api.post('/api/watchlist/remove', { symbol: symbol });
                    if (response.success) {
                        this.watchlist = response.data;
                        this.updateWatchlistDisplay();
                        UIUtils.showAlert(`âœ… å·²ç§»é™¤ ${symbol}`, 'info');
                    } else {
                        UIUtils.showAlert(`âŒ ç§»é™¤å¤±è´¥: ${response.error}`, 'error');
                    }
                } catch (error) {
                    console.error('ç§»é™¤è‚¡ç¥¨å¤±è´¥:', error);
                    UIUtils.showAlert('ç§»é™¤å¤±è´¥: ç½‘ç»œé”™è¯¯', 'error');
                }
            }
            
            updateWatchlistDisplay() {
                const container = document.getElementById('current-watchlist');
                
                if (this.watchlist.length === 0) {
                    container.innerHTML = '<div class="watchlist-loading">è‡ªé€‰è‚¡åˆ—è¡¨ä¸ºç©º</div>';
                    return;
                }
                
                container.innerHTML = this.watchlist.map(symbol => `
                    <div class="watchlist-item">
                        <span>${symbol}</span>
                        <button class="remove-stock" onclick="homeWatchlistManager.removeStock('${symbol}')" title="ç§»é™¤">Ã—</button>
                    </div>
                `).join('');
            }
        }
        
        // å…¨å±€å®ä¾‹
        let homeWatchlistManager;
        
        async function loadSystemStatus() {
            const statusElement = document.getElementById('system-status');
            
            try {
                UIUtils.showLoading(statusElement, 'æ­£åœ¨è·å–ç³»ç»ŸçŠ¶æ€...');
                
                const status = await api.getSystemStatus();
                
                // æ ¼å¼åŒ–å†…å­˜ä¿¡æ¯
                let memoryInfo = 'æœªçŸ¥';
                if (status.memory && typeof status.memory === 'object') {
                    if (status.memory.usage_percent !== undefined) {
                        const memStatus = status.memory.status;
                        const statusIcon = memStatus === 'critical' ? 'ğŸš¨' : 
                                         memStatus === 'warning' ? 'âš ï¸' : 'âœ…';
                        memoryInfo = `${statusIcon} ${status.memory.usage_percent}% (${status.memory.available_gb}GBå¯ç”¨)`;
                    } else {
                        memoryInfo = status.memory.status || 'æœªçŸ¥';
                    }
                } else if (typeof status.memory === 'string') {
                    memoryInfo = status.memory;
                }
                
                // æ ¼å¼åŒ–ç½‘ç»œçŠ¶æ€
                const networkIcon = status.network === 'connected' ? 'âœ…' : 'âŒ';
                const networkText = status.network === 'connected' ? 'å·²è¿æ¥' : 'æœªè¿æ¥';
                
                // æ ¼å¼åŒ–ç»„ä»¶çŠ¶æ€
                const getComponentIcon = (componentStatus) => {
                    switch(componentStatus) {
                        case 'running': case 'available': case 'accessible': return 'âœ…';
                        case 'standby': return 'â¸ï¸';
                        case 'unavailable': case 'inaccessible': return 'âŒ';
                        case 'error': return 'ğŸš¨';
                        default: return 'â“';
                    }
                };
                
                const getComponentText = (componentStatus) => {
                    switch(componentStatus) {
                        case 'running': return 'è¿è¡Œä¸­';
                        case 'available': return 'å¯ç”¨';
                        case 'accessible': return 'å¯è®¿é—®';
                        case 'standby': return 'å¾…æœº';
                        case 'unavailable': return 'ä¸å¯ç”¨';
                        case 'inaccessible': return 'ä¸å¯è®¿é—®';
                        case 'error': return 'é”™è¯¯';
                        default: return componentStatus || 'æœªçŸ¥';
                    }
                };
                
                const dataEngine = status.components?.data_engine || 'unknown';
                const strategyEngine = status.components?.strategy_engine || 'unknown';
                const riskEngine = status.components?.risk_engine || 'unknown';
                const tradingEngine = status.components?.trading_engine || 'unknown';
                
                // åˆ¤æ–­ç³»ç»Ÿæ•´ä½“çŠ¶æ€
                const hasErrors = status.memory?.status === 'critical' || 
                                status.network === 'disconnected' ||
                                dataEngine === 'error' || strategyEngine === 'error';
                
                const hasWarnings = status.memory?.status === 'warning' ||
                                  dataEngine === 'unavailable' || strategyEngine === 'unavailable';
                
                let systemIcon = 'âœ…';
                let systemText = 'ç³»ç»Ÿè¿è¡Œæ­£å¸¸';
                let statusClass = 'status-good';
                
                if (hasErrors) {
                    systemIcon = 'ğŸš¨';
                    systemText = 'ç³»ç»Ÿå­˜åœ¨é—®é¢˜';
                    statusClass = 'status-error';
                } else if (hasWarnings) {
                    systemIcon = 'âš ï¸';
                    systemText = 'ç³»ç»Ÿè¿è¡Œæœ‰è­¦å‘Š';
                    statusClass = 'status-warning';
                }
                
                statusElement.innerHTML = `
                    ${systemIcon} ${systemText}<br>
                    ğŸ• å¯åŠ¨æ—¶é—´: ${status.time}<br>
                    â±ï¸ è¿è¡Œæ—¶é•¿: ${status.uptime || 'æœªçŸ¥'}<br>
                    ğŸ’¾ å†…å­˜ä½¿ç”¨: ${memoryInfo}<br>
                    ğŸŒ ç½‘ç»œè¿æ¥: ${networkIcon} ${networkText}<br>
                    ğŸ”§ æ•°æ®å¼•æ“: ${getComponentIcon(dataEngine)} ${getComponentText(dataEngine)}<br>
                    ğŸ¤– ç­–ç•¥å¼•æ“: ${getComponentIcon(strategyEngine)} ${getComponentText(strategyEngine)}<br>
                    ğŸ›¡ï¸ é£é™©å¼•æ“: ${getComponentIcon(riskEngine)} ${getComponentText(riskEngine)}<br>
                    ğŸ’¼ äº¤æ˜“å¼•æ“: ${getComponentIcon(tradingEngine)} ${getComponentText(tradingEngine)}
                `;
                statusElement.className = `status-info ${statusClass}`;
                
            } catch (error) {
                console.error('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥:', error);
                statusElement.innerHTML = `
                    âŒ ç³»ç»ŸçŠ¶æ€è·å–å¤±è´¥<br>
                    ğŸ”§ è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥<br>
                    ğŸ’¡ å°è¯•åˆ·æ–°é¡µé¢
                `;
                statusElement.className = 'status-info status-error';
            }
        }

                // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            const api = new TradingAPI();
            
            // åˆå§‹åŒ–è‡ªé€‰è‚¡ç®¡ç†å™¨
            homeWatchlistManager = new HomeWatchlistManager();
            
            // åŠ è½½ç³»ç»ŸçŠ¶æ€
            await loadSystemStatus();
        });
    </script>
</body>
</html>